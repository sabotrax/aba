DIM P1(31)
'HP,MN,ATK
P1(0)=8:P1(1)=7:P1(2)=1
'DEF,SP,SPC,SPV
P1(3)=1:P1(6)=1:P1(7)=4:P1(8)=2
'ART,AR1,AR2
'P1(10)=0:P1(11)=0:P1(12)=0
P1(10)=0
P1(15)=0:P1(16)=0:P1(17)=0
P1(20)=0:P1(21)=0:P1(22)=0
'IHP,IMN
P1(25)=8:P1(26)=7
'CLASS
P1(27)=80
'DEBUFFS
P1(28)=0:P1(29)=0:P1(30)=0:P1(31)=0
DIM DP$(4)
DIM AN(10)
ANC=0

'ROLL DICE
D1=0
D2=0
PROC RD
  D1=RAND(12)+1
  D2=RAND(12)+1
ENDPROC

'ATTACK
PROC ATCK
  NHD=P1(2)
ENDPROC

'DEFEND
PROC DFND
  PHD=AN(2) 'W/0 ARTIFACTS
  IF AN(4)=1 'AN SPECIAL: DOT
    O=RAND(6)+1
    IF O>AN(7)
      DP$(0)="HIT BY DOT"
      P1(28)=AN(4):P1(29)=AN(5)
      P1(30)=AN(6):P1(31)=AN(6)
    ENDIF
  ENDIF
ENDPROC

'SPECIAL
PROC SPC
  P1(1)=P1(1)-P1(7) 'SUBTRACT MN
  IF P1(6)=1
    DP$(1)="HEAL"
    P1(0)=P1(0)+P1(8)
  ENDIF
  IF P1(0)>P1(25)
    P1(0)=P1(25)
  ENDIF
ENDPROC

'APPLY DEF ARTIFACTS
PROC ADA ART
  IF P1(ART)=1 'STEADY SHIELD
    DP$(2)="SHIELD!"
    PHD=PHD-P1(ART+1)
  ELIF P1(ART)=2 'ENDLESS SANDBAG
    O=RAND(6)+1
    IF O>4
      DP$(2)="THROW SAND!"
      IF P1(28)=0 'XX SHORTEN?
        PHD=0
      ELIF P1(28)=1 AND P1(30)=P1(31)
        PHD=0
        @CLRDB 28
      ENDIF
    ENDIF
  ELIF P1(ART)=3 'BASSONA
    'PRINT"BASS ";AN(2)
    O=RAND(6)+1
    IF AN(2)=1 AND O>4
      DP$(2)="BASSONA!"
      NHD=1
    ELIF AN(2)>1 AND O>3
      DP$(2)="BASSONA!"
      NHD=AN(2)/2
    ENDIF
    'PRINT"NHD ";NHD
    'GET K
  ENDIF
ENDPROC

'UPDATE DISPLAY
PROC UPDP
  POS. 16,9
  PRINT"               "
  POS. 16,9
  PRINT DP$(0)
  POS. 16,10
  PRINT"               "
  POS. 16,10
  PRINT DP$(1)
  POS. 16,11
  PRINT"                    "
  POS. 16,11
  PRINT DP$(2)
  POS. 9,14
  PRINT"               "
  POS. 9,14
  PRINT P1(0);",";P1(1),,AN(0)
  FOR S=0 TO 2
    DP$(S)=""
  NEXT S
ENDPROC

'DRAW PLAYERS
PROC DRPL
  POS. 9,13
  PRINT CHR$(P1(27));
  IF P1(28)=1
    PRINT"*"; 'DOT MARK
  ENDIF
  PRINT"",,;
  
  IF AN(8)>0
    PRINT CHR$(AN(8));CHR$(AN(9))
  ELSE
    PRINT CHR$(AN(9))
  ENDIF

  I=16
  FOR J=10 TO 20 STEP 5
    IF P1(J)>0
      POS. 4,I
      PRINT $(P1(J+4));
      INC I
    ENDIF
  NEXT J
ENDPROC

'INIT NPCS
PROC IN
  DIM NP1(10):DIM NP2(10):DIM NP3(10)
  DIM NP4(10):DIM NP5(10):DIM NP6(10)
  DIM NP7(10):DIM NP8(10)
  DIM NPS(8)
  NP1(0)=8:NP1(1)=4:NP1(2)=2:NP1(3)=2
  'DOT,DMG,DURATION,HIT
  'NP1(4)=1:NP1(5)=1:NP1(6)=3:NP1(7)=3

  NP1(9)=100
  NP2(0)=9:NP2(1)=4:NP2(2)=0:NP2(3)=3
  NP2(4)=1:NP2(5)=2:NP2(6)=2:NP2(7)=4
  NP2(8)=115:NP2(9)=100
  NP3(0)=6:NP3(1)=4:NP3(2)=3:NP3(3)=2
  NP3(8)=97:NP3(9)=100
  NPS(0)=ADR(NP1):NPS(1)=ADR(NP2)
  NPS(2)=ADR(NP3)
ENDPROC

'INIT ARTIFACTS
PROC IA
  DIM A1(3):DIM A2(3):DIM A3(3)
  DIM AS(3)
  A1N$="STEADY SHIELD" 'ART. NAME
  A1(0)=1:A1(1)=ADR(A1N$):A1(2)=1
  A2N$="ENDLESS SANDBAG"
  A2(0)=2:A2(1)=ADR(A2N$):A2(2)=0
  A3N$="BASSONA"
  A3(0)=3:A3(1)=ADR(A3N$):A3(2)=0
  AS(0)=ADR(A1):AS(1)=ADR(A2)
  AS(2)=ADR(A3)
ENDPROC

'LOAD NEXT NPC
PROC LNNPC
  'PRINT "ANC ";ANC
  'PRINT "MEMPOS ";NPS(ANC)
  J=0
  'ANC=2
  FOR I=NPS(ANC) TO NPS(ANC)+18 STEP 2

    AN(J)=DPEEK(I)
    'PRINT AN(J)
    J=J+1
  NEXT I
ENDPROC

'CLEAR DEBUFF
PROC CLRDB DB
  P1(DB)=0:P1(DB+1)=0
  P1(DB+2)=0:P1(DB+3)=0
  'PRINT"IN CLRDB"
ENDPROC

'GET RANDOM ARTIFACT
PROC GRA
  I=RAND(3) 'LEN. AS
  'I=0 'XX
  DIM RA(3):K=0 'RANDOM ART.
  FOR J=AS(I) TO AS(I)+4 STEP 2
    RA(K)=DPEEK(J)
    K=K+1
  NEXT J
  'FOR L=0 TO 2
    'PRINT RA(L)
  'NEXT L
  GET K
ENDPROC

'GET REWARD
PROC GR
  POS. 9,2:PRINT"COLLECT YOUR REWARD"
  @GRA
  POS. 10,3:PRINT"(";RA(0);") ";
  PRINT $(RA(1))
  POS. 10,4:PRINT"(C) COINS"
  DO
    GET I
    IF I=RA(0)+48 'ATASCII
      'COPY RA -> P1
      CPD=0 'COPIED
      'XX BETTER CHOOSE ART. SLOT
      FOR J=10 TO 20 STEP 5
        IF P1(J)=0 AND CPD=0
          P1(J)=RA(0)
          P1(J+1)=RA(2) 'XX SHLD BE NA
ME
          P1(J+4)=RA(1) 'XX TMP
          CPD=1
          'PRINT"ART. COPIED"
          'PRINT"ART. ";P1(J);" ";P1(J
+1)
        ENDIF
      NEXT J
      EXIT
    ELIF I=67
      PRINT"NOT IMPLEMENTED YET"
      EXIT
    ENDIF
  LOOP
ENDPROC

'MAIN
@IN
@IA
CLS
REPEAT
  PHD=0:NHD=0 'HP DELTAS
  IF AN(0)=0 AND ANC<3
    IF ANC>0
      @GR:PAUSE 100
      CLS
    ENDIF
    @LNNPC
    P1(0)=P1(25):P1(1)=P1(26)
    @CLRDB 28
    ANC=ANC+1
    @DRPL
    DP$(0)="READY?"
    @UPDP
    GET K
  ELIF AN(0)=0
    EXIT
  ENDIF

  @RD
  IF D1>(D2+AN(3))
    DP$(0)="STRIKE"
    @ATCK
  ELIF D2>(D1+P1(3))
    IF AN(2)>0
      DP$(0)="GOT HIT"
    ELSE
      DP$(0)="BITE"
    ENDIF
    @DFND
  ELSE
    DP$(0)="PARRY"
  ENDIF

  'PRINT"DBS ";P1(28);P1(29);P1(30);P1
(31)
  IF P1(28)=1 AND P1(30)>0 'APPLY DBFS

    PHD=PHD+P1(29)
    'PRINT"PHD IDB ";PHD
  ENDIF

  @DRPL

  'PRINT"PHD VA ";PHD
  FOR A=10 TO 20 STEP 5
    IF P1(A)>0
      IF D2>(D1+P1(3)) OR P1(28)>0
        EXEC ADA A
      ENDIF
    ENDIF
  NEXT A
  'PRINT"PHD NA ";PHD

  IF NHD<0 THEN NHD=0 'CALC NPC HP
  AN(0)=AN(0)-NHD:NHD=0 'CALC NPC HP
  IF AN(0)<0
    AN(0)=0
  ENDIF

  IF PHD<0 THEN PHD=0 'CALC PLR HP
  P1(0)=P1(0)-PHD:PHD=0
  IF P1(0)<0
    P1(0)=0
  ENDIF

  IF P1(1)>=P1(7) 'CAST SPECIAL
    @SPC
  ENDIF
  
  IF P1(28)>0 AND P1(30)>0
    P1(30)=P1(30)-1
    'PRINT"DBDU ";P1(30)
    IF P1(30)=0
      @CLRDB 28
    ENDIF
  ENDIF

  P1(1)=P1(1)+1 'REPLENISH MN
  IF P1(1)>P1(26)
    P1(1)=P1(26)
  ENDIF
  @UPDP
  PAUSE 50
  IF AN(0)=0
    DP$(0)="GOOD JOB!"
    @UPDP
    PAUSE 200
  ENDIF
  'GET K:CLS
UNTIL P1(0)<=0
POS. 16,7
IF P1(0)<=0 AND AN(0)<=0
  PRINT"STALEMATE!"
ELIF P1(0)<=0
  PRINT"LOST"
ELSE
  PRINT"WON!"
ENDIF
